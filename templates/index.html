<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>教育用 Proxy Browser</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header class="topbar">
  <div class="controls">
    <input id="urlInput" placeholder="https://example.com">
    <button id="goBtn">Go</button>
  </div>
</header>

<div id="loader" class="loader-wrap" aria-hidden="true" style="display:none;">
  <div class="spinner"></div>
  <div class="loader-text">読み込み中…</div>
</div>

<iframe id="viewFrame" sandbox="allow-scripts allow-forms" style="display:block;"></iframe>

<script>
const frame = document.getElementById('viewFrame');
const loader = document.getElementById('loader');
const urlInput = document.getElementById('urlInput');
const goBtn = document.getElementById('goBtn');

// loader の表示/非表示（ボタン押下時のみ表示される）
function showLoader(){ loader.style.display = 'flex'; frame.style.display = 'none'; }
function hideLoader(){ loader.style.display = 'none'; frame.style.display = 'block'; }

// 正規化（入力値が空白のときは何もしない）
function normalize(u){
  if(!u) return '';
  u = u.trim();
  if(!u) return '';
  if(!u.match(/^https?:\/\//)) u = 'https://' + u;
  return u;
}

// 実際に読み込む処理は goBtn のクリック時だけ呼ぶ
function loadByButton() {
  const raw = urlInput.value;
  const u = normalize(raw);
  if(!u) return;
  showLoader();
  // 履歴管理などが必要な場合はここで扱う（簡易版）
  frame.src = '/proxy?url=' + encodeURIComponent(u);
}

// 「Enter」での即読み込みを無効化する（Enterはボタンフォーカス移動のみ）
urlInput.addEventListener('keydown', function(e){
  if(e.key === 'Enter') {
    // デフォルトのフォーム送信を阻止して何もしない（ユーザーがGoを押すまで待つ）
    e.preventDefault();
    // ここでフォーカスをGoボタンに移す（任意のUX）
    goBtn.focus();
    return false;
  }
});

// Go ボタンは通常通り読み込み開始
goBtn.addEventListener('click', loadByButton);

// iframe の onload で loader を閉じる
frame.addEventListener('load', function(){
  // 読み込み成功時は loader を閉じて iframe を表示
  hideLoader();
});

// 初期表示では loader を出さない、iframe の src も空にしておく
hideLoader();

</script>
</body>
</html>
